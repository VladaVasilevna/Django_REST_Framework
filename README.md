# Проект для онлайн-обучения

## Описание проекта

Проект представляет собой backend-сервис на Django с REST API для управления курсами, уроками и пользователями. Используются PostgreSQL для хранения данных, Redis для очередей задач Celery, а также Celery и Celery Beat для фоновых и периодических задач.

---

## Основные компоненты

- **backend** — Django приложение с REST API
- **db** — база данных PostgreSQL
- **redis** — брокер сообщений для Celery
- **celery** — воркер для фоновых задач
- **celery-beat** — планировщик периодических задач

---

## Требования

- Установленный Docker Desktop (Windows)
- Docker Compose (входит в состав Docker Desktop)
- Файл `.env` с настройками проекта (уже есть в корне)

---

## Установка и запуск через Docker Compose

1. Клонируйте репозиторий и перейдите в корень проекта:
- git clone <URL_вашего_репозитория>
- cd <название_папки_проекта>
2. Убедитесь, что в корне проекта есть файлы:

- `docker-compose.yaml`
- `Dockerfile`
- `requirements.txt`
- `.env`

3. Запустите сборку и запуск всех сервисов командой:


     docker compose up --build

4. Docker Compose автоматически создаст и запустит контейнеры для всех сервисов: backend, PostgreSQL, Redis, Celery и Celery Beat.

---

## Проверка работоспособности сервисов

## **Backend (Django API):**

Откройте в браузере или используйте curl/postman:

     http://localhost:8000/

Должен ответить сервер Django (например, админка по `/admin/` или API эндпоинты).

## **PostgreSQL:**

Проверьте, что контейнер базы данных запущен:

     docker compose ps

В списке должен быть сервис `db` со статусом `Up`.

Для подключения можно использовать любой PostgreSQL клиент по адресу:

     localhost:5432

с параметрами из `.env` (`NAME`, `DB_USER`, `DB_PASSWORD`).

## **Redis:**

Аналогично, в списке контейнеров должен быть сервис `redis` со статусом `Up`.

Порт Redis — `6379`.

## **Celery и Celery Beat:**

В логах контейнеров `celery` и `celery-beat` должны отображаться сообщения о запуске воркера и планировщика.

Для просмотра логов используйте:

     docker compose logs celery
     docker compose logs celery-beat

---

## Остановка и удаление контейнеров

Для остановки всех сервисов нажмите `Ctrl+C` в терминале с запущенным Docker Compose или выполните:

     docker compose down

---

## Полезные команды

Просмотр запущенных контейнеров проекта:

     docker compose ps

Просмотр логов всех сервисов:

     docker compose logs -f

Пересборка образов и перезапуск:

     docker compose up --build -d

## Настройка удалённого сервера и деплой
1. Подготовка удалённого сервера
    - Установите Docker и Docker Compose на сервере.
    - Создайте пользователя с правами для деплоя.
    - Настройте SSH-доступ с вашего локального компьютера к серверу через ключи.
    - Добавьте публичный SSH-ключ в файл ~/.ssh/authorized_keys пользователя на сервере.
    - В репозитории GitHub сохраните приватный ключ в Secrets для автоматического подключения из workflow.

2. Запуск GitHub Actions workflow
    - При пуше в ветку автоматически запускается workflow из .github/workflows/ci-cd.yml.
    - Workflow выполняет:
	- Запуск тестов
	- Сборку Docker-образов
	- Подключение к серверу по SSH
	- Обновление кода и перезапуск сервисов через docker compose up -d --build

3. Основные команды для работы на сервере
# Подключение к серверу по SSH
ssh myuser@your_server_ip

# Перейти в директорию проекта
cd /path/to/your/project

# Запуск контейнеров (если нужно вручную)
docker compose up -d --build

# Просмотр логов сервисов
docker compose logs -f

# Остановка контейнеров
docker compose down
